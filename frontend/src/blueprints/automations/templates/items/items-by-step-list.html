<!-- Items -->
<div class="card-body">
    <div id="automations" class="row mb-4">
        <div class="table-responsive">
            <table class="table align-middle table-nowrap table-hover" id="table-items">
                <thead class="">
                    <tr>
                        <th hidden>UUID</th>
                        <th>#</th>
                        {% for field in fields %}
                        <th>{{ field.alias | upper }}</th>
                        {% endfor %}
                        <th>Status</th>
                        <th class="text-end">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        <td hidden>{{item.uuid}}</td>
                        <td>
                            {% if item.status == 'pending' %}
                                <i class="tf-icon bx bx-xs bx-time text-warning"></i>
                            {% elif item.status == 'running' %}
                                <i class="tf-icon bx bx-xs bx-loader-alt bx-spin text-primary"></i>
                            {% elif item.status == 'finished' %}
                                <i class="tf-icon bx bx-xs bx-check text-success"></i>
                            {% elif item.status == 'error' %}
                                <i class="tf-icon bx bx-xs bx-x text-danger"></i>
                            {% elif item.status == 'canceled' %}
                                <i class="tf-icon bx bx-xs bx-cancel text-danger"></i>
                            {% elif item.status == 'paused' %}
                                <i class="tf-icon bx bx-xs bx-pause text-warning"></i>
                            {% endif %}
                        </td>
                        {% for field in fields %}
                            <td>
                                {% if field.type == 'url' %}
                                    <a href="{{ item.data[field.name] }}" target="_blank"><i class="tf-icon bx bx-xs bx-link-external text-primary"></i></a>
                                {% else %}
                                    {{ item.data[field.name] }}
                                {% endif %}
                            </td>
                        {% endfor %}
                        <td>
                            {% if item.status == 'pending' %}
                                <span class="badge bg-label-warning">PENDENTE</span>
                            {% elif item.status == 'running' %}
                                <span class="badge bg-label-primary">EXECUTANDO</span>
                            {% elif item.status == 'finished' %}
                                <span class="badge bg-label-success">FINALIZADO</span>
                            {% elif item.status == 'error' %}
                                <span class="badge bg-label-danger">ERRO</span>
                            {% elif item.status == 'canceled' %}
                                <span class="badge bg-label-danger">CANCELADO</span>
                            {% elif item.status == 'paused' %}
                                <span class="badge bg-label-warning">PAUSADO</span>
                            {% endif %}
                            </td>
                        <td class="text-end">
                            <a href="{{url_for('automations.view_item', uuid=item.uuid)}}"
                               id="{{ item.uuid }}"
                               data-step="{{ item.step.uuid }}"
                               data-automation="{{ automation.uuid }}"
                               type="button"
                               class="btn p-0 text-primary pull-up-full">
                                <i class="bx bx-xs bx-show"></i>
                            </a>
                            <a href="javascript:void(0);"
                               id="{{ item.uuid }}"
                               data-step="{{ item.step.uuid }}"
                               data-automation="{{ automation.uuid }}"
                               data-origin="list"
                               type="button"
                               class="btn p-0 text-info pull-up-full edititembystep">
                                <i class="bx bx-xs bx-edit"></i>
                            </a>
                            <a href="javascript:void(0);"
                               id="{{ item.uuid }}"
                               data-id="{{ item.uuid }}"
                               data-step="{{ item.step.uuid }}"
                               data-automation="{{ automation.uuid }}"
                               type="button"
                               class="btn p-0 text-danger pull-up-full a-delete-item">
                                <i class="bx bx-xs bx-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-12 mb-4 order-0">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-rounded justify-content-center mt-2 mb-5">
                    <li class="page-item prev {% if pagination.current_page == 1 %}disabled{% else %}pull-up-full{% endif %}">
                      <a id="1" class="page-link a-page-item-by-step" href="javascript:void(0);" data-step="{{step.uuid}}">
                          <i class="tf-icon bx bx-chevrons-left"></i>
                      </a>
                    </li>
                    {% for page_num in range(1, pagination.total_pages + 1) %}
                        {% if page_num %}
                            {% if pagination.current_page == page_num %}
                            <li class="page-item active pull-up-full">
                              <a id="{{page_num}}" class="page-link a-page-item-by-step" href="javascript:void(0);" data-step="{{step.uuid}}">{{ page_num }}</a>
                            </li>
                            {% else %}
                            <li class="page-item pull-up-full">
                              <a id="{{page_num}}" class="page-link a-page-item-by-step" href="javascript:void(0);" data-step="{{step.uuid}}">{{ page_num }}</a>
                            </li>
                            {% endif %}
                        {% else %}
                            ...
                        {% endif %}
                    {% endfor %}
                    <li class="page-item next
                    {% if pagination.current_page == pagination.total_pages %}
                    disabled
                    {% elif pagination.total_pages == 0 %}
                    disabled
                    {% else %}
                    pull-up-full
                    {% endif %}"
                    >
                      <a id="{{ pagination.total_pages}}" class="page-link a-page-item-by-step" href="javascript:void(0);" data-step="{{step.uuid}}">
                          <i class="tf-icon bx bx-chevrons-right"></i>
                      </a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
          return new bootstrap.Popover(popoverTriggerEl)
        })
    });

    $(".a-delete-item").click(function (e) {
        e.preventDefault();
        var id = $(this).attr("id");
        var item = $(this).attr("data-id");
        var automation_uuid = '{{ automation.uuid }}';
        var step_uuid = $(this).attr("data-step");

        $('#delete').attr("data-id", "div-" + id);
        $('#delete').addClass('deleteitem');
        $('#delete').attr("data-step", step_uuid);
        $('#delete').attr("data-automation", automation_uuid);

        $('.modal-body').html('Deseja realmente excluir o item <b>' + item + '</b>?');
        $('#confirmDelete').modal('show');
    });
</script>

